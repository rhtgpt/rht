Requirement Understanding – TOM (Store/BDC Returns & Validation)
1. Purpose

The TOM (Transfer Order Management) system needs to validate the Store/BDC service area pairing for transfer orders (TOs), particularly for non-allocated/open TOs.
This ensures that orders are routed correctly and prevents invalid Store/BDC combinations from moving forward.

2. Key Integrations

Service Area Integration – Used to validate Store/BDC pairing.

YAML links for outbound integrations: SCNP Design Confluence Page

Contacts:

Ritesh Kumar (SSC-B)

Ryan Fehnal (US-based dev)

Suriya E. Prakash (Product)

3. Execution Flow
Daily / Nightly Process

TOM runs a process (daily or nightly) to check:

All non-allocated and open TOs.

Validity of the Store/BDC pairing using Service Area mapping.

Conditions for Validation

TOM validates existing TOs when:

TO Level Status = OPEN (not "FULFILLMENT IN PROGRESS")

TO Order Line Status = CREATED (less than "ALLOCATED")

TO Type ≠ "CT" (exclude TOs with this type)

4. Decision Logic
A. Store/BDC Pairing is VALID for all order lines

Action: No further steps required.

B. Store/BDC Pairing is INVALID for ALL order lines

Action:

Cancel the entire TO.

Set reason = INVALID SERVICE AREA.

Publish a TO CANCELLED event for consumers.

Scenarios:

Single Line TO – Invalid service area.

Multi-Line TO – All lines have invalid service area.

C. Store/BDC Pairing is INVALID for some order lines (but valid for others)

Action:

Cancel only invalid order lines.

Keep valid lines as-is.

Publish TO UPDATE event for consumers.

Scenario Example (Multi-line TO):

Line 1 → VALID service area.

Line 2 → INVALID service area → Cancelled.

5. Error Reporting

For Store-BDC:

TOM rejects the TO and sends an update to Bullseye.

Bullseye sends a new TO request with the correct Store/BDC pairing.

For TOM Consumers (e.g., IRP, Keystone):

Method of error reporting is TBD for some cases.

6. Test Readiness

Once the above validations and integrations are in place, it will be ready for E2E testing.

7. Summary Table
Scenario	Store/BDC Pairing	Action	Event Published
A	All Valid	No action	None
B	All Invalid	Cancel Entire TO	TO CANCELLED
C	Some Invalid	Cancel Invalid Lines	TO UPDATE
